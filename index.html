<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ (Job Distributor)</title>
    
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.0/package/dist/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap');
        body { font-family: 'Sarabun', sans-serif; }
        .hide-on-print { }
    </style>
</head>
<body class="bg-gray-100 min-h-screen p-6">

    <div id="app" class="max-w-7xl mx-auto">
        
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-blue-700">‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏ö‡πà‡∏á‡∏á‡∏≤‡∏ô‡∏ï‡∏≤‡∏°‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å</h1>
            <p class="text-gray-600">‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÅ‡∏•‡∏∞‡πÄ‡∏Å‡∏•‡∏µ‡πà‡∏¢‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡πâ‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô‡∏°‡∏µ‡∏†‡∏≤‡∏£‡∏∞‡∏á‡∏≤‡∏ô‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
            
            <div class="lg:col-span-5 space-y-6">
                
                <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-blue-500">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold">1. ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ({{ employees.length }} ‡∏Ñ‡∏ô)</h2>
                        <button @click="addEmployee" class="bg-blue-100 text-blue-700 px-3 py-1 rounded hover:bg-blue-200 text-sm">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ô</button>
                    </div>
                    <div class="space-y-2 max-h-60 overflow-y-auto pr-2">
                        <div v-for="(emp, index) in employees" :key="index" class="flex items-center gap-2">
                            <span class="text-gray-400 w-6">{{ index + 1 }}.</span>
                            <input type="text" v-model="emp.name" class="flex-1 border border-gray-300 rounded px-2 py-1 focus:outline-none focus:border-blue-500" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô">
                            <button @click="removeEmployee(index)" class="text-red-400 hover:text-red-600 font-bold px-2">√ó</button>
                        </div>
                    </div>
                </div>

                <div class="bg-white p-6 rounded-lg shadow-md border-l-4 border-orange-500">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold">2. ‡∏ä‡∏∏‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏á‡∏≤‡∏ô ({{ taskSets.length }} ‡∏ä‡∏∏‡∏î)</h2>
                        <button @click="addTaskSet" class="bg-orange-100 text-orange-700 px-3 py-1 rounded hover:bg-orange-200 text-sm">+ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ä‡∏∏‡∏î‡∏á‡∏≤‡∏ô</button>
                    </div>
                    
                    <div class="space-y-4">
                        <div v-for="(set, setIndex) in taskSets" :key="set.id" class="border border-gray-200 rounded-lg p-3 bg-gray-50">
                            <div class="flex justify-between items-center mb-2">
                                <span class="font-bold text-gray-700">‡∏ä‡∏∏‡∏î‡∏ó‡∏µ‡πà {{ setIndex + 1 }} <span v-if="setIndex === 0" class="text-xs text-red-500">(‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏∏‡∏î)</span></span>
                                <button @click="removeTaskSet(setIndex)" class="text-red-400 hover:text-red-600 text-xs">‡∏•‡∏ö‡∏ä‡∏∏‡∏î‡∏ô‡∏µ‡πâ</button>
                            </div>
                            
                            <div class="mb-2">
                                <label class="text-xs text-gray-500">‡πÉ‡∏™‡πà‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏á‡∏≤‡∏ô (‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ ‡∏´‡∏£‡∏∑‡∏≠ ‡∏Ç‡∏∂‡πâ‡∏ô‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î‡πÉ‡∏´‡∏°‡πà)</label>
                                <textarea v-model="set.rawInput" @input="parseTasks(setIndex)" 
                                    class="w-full h-20 border border-gray-300 rounded p-2 text-sm focus:outline-none focus:border-orange-500" 
                                    placeholder="‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á: 55 20 14 16"></textarea>
                            </div>
                            <div class="flex justify-between text-xs text-gray-500">
                                <span>‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: {{ set.tasks.length }} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</span>
                                <span>‡∏ú‡∏•‡∏£‡∏ß‡∏°: {{ sumArray(set.tasks) }}</span>
                            </div>
                        </div>
                    </div>
                </div>

                <button @click="calculateDistribution" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg shadow-lg transition transform hover:scale-105">
                    üöÄ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏Å‡∏≤‡∏£‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏á‡∏≤‡∏ô
                </button>

            </div>

            <div class="lg:col-span-7">
                
                <div v-if="distributedResults.length > 0">
                    <div class="flex flex-wrap gap-2 mb-4 justify-end">
                        <button @click="exportToText" class="bg-gray-600 text-white px-3 py-1 rounded text-sm hover:bg-gray-700">üìã Copy Text</button>
                        <button @click="exportToExcel" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700">üìä Excel</button>
                        <button @click="exportToImage" class="bg-purple-600 text-white px-3 py-1 rounded text-sm hover:bg-purple-700">üñºÔ∏è Image</button>
                        <button @click="exportToPDF" class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700">üìÑ PDF</button>
                    </div>

                    <div id="export-area" class="bg-white p-8 rounded-lg shadow-lg min-h-[500px]">
                        <div class="text-center mb-6 border-b pb-4">
                            <h2 class="text-2xl font-bold">‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡∏á‡∏≤‡∏ô</h2>
                            <div class="flex justify-center gap-6 mt-2 text-sm text-gray-600">
                                <span>‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: <b>{{ grandTotalItems }}</b> ‡∏ä‡∏¥‡πâ‡∏ô</span>
                                <span>Weight ‡∏£‡∏ß‡∏°: <b>{{ grandTotalWeight }}</b></span>
                                <span>‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢/‡∏Ñ‡∏ô: <b>~{{ (grandTotalWeight / employees.length).toFixed(1) }}</b></span>
                            </div>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div v-for="result in distributedResults" :key="result.employeeName" class="border rounded-lg p-4 bg-gray-50">
                                <div class="flex justify-between items-center mb-2 border-b border-gray-200 pb-2">
                                    <h3 class="font-bold text-lg text-blue-800">{{ result.employeeName }}</h3>
                                    <div class="text-right">
                                        <div class="text-xs text-gray-500">‡∏£‡∏ß‡∏° Weight</div>
                                        <div class="font-bold text-xl">{{ result.totalWeight }}</div>
                                    </div>
                                </div>
                                
                                <div class="space-y-1">
                                    <div v-for="(task, tIndex) in result.tasks" :key="tIndex" 
                                         class="flex justify-between items-center text-sm px-2 py-1 rounded"
                                         :class="getSetColor(task.setId)">
                                        <span>
                                            <span class="font-bold mr-1">{{ task.value }}</span>
                                            <span class="text-xs opacity-75">(‡∏ä‡∏∏‡∏î {{ task.setId }})</span>
                                        </span>
                                        <span class="w-4 h-4 rounded-full border border-gray-400"></span>
                                    </div>
                                </div>
                                <div class="mt-3 text-xs text-gray-500 text-right">
                                    ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô: {{ result.tasks.length }} ‡∏ä‡∏¥‡πâ‡∏ô
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div v-else class="h-full flex flex-col items-center justify-center text-gray-400 border-2 border-dashed border-gray-300 rounded-lg bg-gray-50 min-h-[300px]">
                    <svg class="w-16 h-16 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path></svg>
                    <p>‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡∏∞‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì</p>
                </div>

            </div>
        </div>

    </div>

    <script>
        const { createApp } = Vue;

        createApp({
            data() {
                return {
                    employees: [
                        { name: '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô 1' },
                        { name: '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô 2' },
                        { name: '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô 3' },
                        { name: '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô 4' },
                        { name: '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô 5' },
                        { name: '‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô 6' }
                    ],
                    taskSets: [
                        { id: 1, rawInput: "55 20 14 16 12", tasks: [] },
                        { id: 2, rawInput: "6 27 20 28 39 28 12 10 6 43", tasks: [] },
                        { id: 3, rawInput: "10 19 8 29 18", tasks: [] }
                    ],
                    distributedResults: []
                }
            },
            computed: {
                grandTotalWeight() {
                    return this.taskSets.reduce((sum, set) => sum + this.sumArray(set.tasks), 0);
                },
                grandTotalItems() {
                    return this.taskSets.reduce((sum, set) => sum + set.tasks.length, 0);
                }
            },
            mounted() {
                // Parse initial data
                this.taskSets.forEach((set, index) => this.parseTasks(index));
            },
            methods: {
                addEmployee() {
                    this.employees.push({ name: `‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô ${this.employees.length + 1}` });
                },
                removeEmployee(index) {
                    if (this.employees.length > 1) this.employees.splice(index, 1);
                },
                addTaskSet() {
                    this.taskSets.push({ id: Date.now(), rawInput: "", tasks: [] });
                },
                removeTaskSet(index) {
                    this.taskSets.splice(index, 1);
                },
                sumArray(arr) {
                    return arr.reduce((a, b) => a + b, 0);
                },
                parseTasks(index) {
                    const raw = this.taskSets[index].rawInput;
                    // ‡πÅ‡∏¢‡∏Å‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç‡∏î‡πâ‡∏ß‡∏¢ space, comma, ‡∏´‡∏£‡∏∑‡∏≠ newline
                    const numbers = raw.match(/-?\d+(\.\d+)?/g);
                    if (numbers) {
                        this.taskSets[index].tasks = numbers.map(Number);
                    } else {
                        this.taskSets[index].tasks = [];
                    }
                },
                getSetColor(setId) {
                    if (setId === 1) return 'bg-red-100 text-red-900 border-l-4 border-red-500';
                    if (setId === 2) return 'bg-orange-100 text-orange-900 border-l-4 border-orange-500';
                    if (setId === 3) return 'bg-blue-100 text-blue-900 border-l-4 border-blue-500';
                    return 'bg-gray-100 text-gray-900 border-l-4 border-gray-400';
                },
                
                calculateDistribution() {
                    // Reset
                    let empWorkloads = this.employees.map(e => ({
                        name: e.name,
                        tasks: [],
                        totalWeight: 0
                    }));

                    // Process each set sequentially (Set 1 first, then Set 2...)
                    // ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏á‡∏≤‡∏ô‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç (Set 1) ‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏∞‡∏à‡∏≤‡∏¢‡∏Å‡πà‡∏≠‡∏ô ‡πÅ‡∏•‡πâ‡∏ß‡∏á‡∏≤‡∏ô‡∏£‡∏≠‡∏á (Set 2) ‡∏Ñ‡πà‡∏≠‡∏¢‡πÑ‡∏õ‡πÄ‡∏ï‡∏¥‡∏°‡∏Ñ‡∏ô‡∏ß‡πà‡∏≤‡∏á
                    this.taskSets.forEach((set, setIndex) => {
                        const setId = setIndex + 1;
                        
                        // Sort tasks in this set descending (‡πÉ‡∏´‡∏ç‡πà‡πÑ‡∏õ‡πÄ‡∏•‡πá‡∏Å) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡πÄ‡∏Å‡∏•‡∏µ‡πà‡∏¢‡∏ó‡∏µ‡πà‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î
                        let sortedTasks = [...set.tasks].sort((a, b) => b - a);

                        sortedTasks.forEach(taskValue => {
                            // ‡∏´‡∏≤‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏á‡∏≤‡∏ô‡∏£‡∏ß‡∏°‡∏ô‡πâ‡∏≠‡∏¢‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î ‡∏ì ‡∏ï‡∏≠‡∏ô‡∏ô‡∏±‡πâ‡∏ô (Greedy Approach)
                            // Sort employees by current total weight (Ascending)
                            empWorkloads.sort((a, b) => a.totalWeight - b.totalWeight);
                            
                            // ‡πÉ‡∏´‡πâ‡∏á‡∏≤‡∏ô‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡πâ‡∏≠‡∏¢‡∏™‡∏∏‡∏î
                            empWorkloads[0].tasks.push({ value: taskValue, setId: setId });
                            empWorkloads[0].totalWeight += taskValue;
                        });
                    });

                    // ‡∏™‡∏∏‡∏î‡∏ó‡πâ‡∏≤‡∏¢ Sort Task ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Ñ‡∏ô‡πÉ‡∏´‡πâ Set 1 ‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡πÄ‡∏™‡∏°‡∏≠ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°‡πÉ‡∏ô‡πÉ‡∏ö‡∏á‡∏≤‡∏ô
                    empWorkloads.forEach(emp => {
                        emp.tasks.sort((a, b) => {
                            if (a.setId !== b.setId) return a.setId - b.setId; // ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏° Set
                            return b.value - a.value; // ‡πÉ‡∏ô Set ‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô ‡πÄ‡∏£‡∏µ‡∏¢‡∏á‡∏ï‡∏≤‡∏°‡∏Ñ‡πà‡∏≤‡∏°‡∏≤‡∏Å
                        });
                    });

                    // Sort ‡∏Ñ‡∏ô‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏•‡∏±‡∏ö‡∏Ñ‡∏∑‡∏ô (optional) ‡∏´‡∏£‡∏∑‡∏≠‡∏à‡∏∞ Sort ‡∏ï‡∏≤‡∏°‡∏†‡∏≤‡∏£‡∏∞‡∏á‡∏≤‡∏ô‡∏Å‡πá‡πÑ‡∏î‡πâ
                    // ‡πÉ‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πâ‡∏Ç‡∏≠ Sort ‡∏ï‡∏≤‡∏°‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏î‡∏¥‡∏° input
                    let finalResults = [];
                    this.employees.forEach(e => {
                        const found = empWorkloads.find(w => w.name === e.name);
                        finalResults.push({
                            employeeName: e.name,
                            tasks: found.tasks,
                            totalWeight: found.totalWeight
                        });
                    });

                    this.distributedResults = finalResults;
                },

                // --- EXPORT FUNCTIONS ---
                exportToText() {
                    let text = "‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡πÅ‡∏ö‡πà‡∏á‡∏á‡∏≤‡∏ô\n------------------\n";
                    this.distributedResults.forEach(res => {
                        text += `\n${res.employeeName} (‡∏£‡∏ß‡∏°: ${res.totalWeight})\n`;
                        res.tasks.forEach(t => {
                            text += `- ${t.value} (‡∏ä‡∏∏‡∏î ${t.setId})\n`;
                        });
                    });
                    navigator.clipboard.writeText(text).then(() => alert("‡∏Ñ‡∏±‡∏î‡∏•‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏•‡πâ‡∏ß!"));
                },
                exportToExcel() {
                    let data = [];
                    this.distributedResults.forEach(res => {
                        res.tasks.forEach(t => {
                            data.push({
                                "‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô": res.employeeName,
                                "‡∏ä‡∏∏‡∏î‡∏á‡∏≤‡∏ô": t.setId,
                                "‡∏Ñ‡πà‡∏≤‡∏á‡∏≤‡∏ô": t.value,
                                "‡∏ú‡∏•‡∏£‡∏ß‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô": res.totalWeight
                            });
                        });
                    });
                    const ws = XLSX.utils.json_to_sheet(data);
                    const wb = XLSX.utils.book_new();
                    XLSX.utils.book_append_sheet(wb, ws, "Distribution");
                    XLSX.writeFile(wb, "job_distribution.xlsx");
                },
                exportToImage() {
                    const element = document.getElementById('export-area');
                    html2canvas(element).then(canvas => {
                        const link = document.createElement('a');
                        link.download = 'distribution.png';
                        link.href = canvas.toDataURL();
                        link.click();
                    });
                },
                exportToPDF() {
                    const element = document.getElementById('export-area');
                    const opt = {
                        margin:       0.5,
                        filename:     'job_distribution.pdf',
                        image:        { type: 'jpeg', quality: 0.98 },
                        html2canvas:  { scale: 2 },
                        jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
                    };
                    html2pdf().set(opt).from(element).save();
                }
            }
        });
    </script>
</body>
</html>
